# LLMå¾®è°ƒéœ€è¦å¤šå°‘æ˜¾å­˜



## å½±å“æ˜¾å­˜å ç”¨çš„ 4 ä¸ªå…³é”®å› ç´ 



| å› ç´                              | è¯´æ˜Ž                                                         |
| -------------------------------- | ------------------------------------------------------------ |
| **æ¨¡åž‹è§„æ¨¡ï¼ˆå‚æ•°é‡ï¼‰**           | æ¨¡åž‹è¶Šå¤§ï¼Œå æ˜¾å­˜è¶Šå¤šã€‚æ¯”å¦‚ 7B â‰ˆ 14GBï¼ˆFP16ï¼‰ï¼›13B â‰ˆ 26GBï¼›70B â‰ˆ 140GBã€‚ |
| **ç²¾åº¦ï¼ˆPrecisionï¼‰**            | è®­ç»ƒæ—¶å‚æ•°çš„æ•°å€¼ç²¾åº¦ã€‚FP16 å ç”¨æœ€å¤šï¼ŒBF16/FP8/INT8/QLoRA ç­‰å¯æ˜¾è‘—å‡å°æ˜¾å­˜ã€‚ |
| **æ‰¹æ¬¡å¤§å°ï¼ˆBatch Sizeï¼‰**       | æ¯æ¬¡é€å…¥æ¨¡åž‹çš„æ ·æœ¬æ•°é‡ã€‚æ‰¹æ¬¡è¶Šå¤§ï¼Œå æ˜¾å­˜è¶Šå¤šã€‚               |
| **æ¢¯åº¦å­˜å‚¨æ–¹å¼ï¼ˆæ˜¯å¦å…¨å‚è®­ç»ƒï¼‰** | å…¨é‡å¾®è°ƒéœ€è¦å­˜æ¢¯åº¦ã€ä¼˜åŒ–å™¨çŠ¶æ€ï¼ŒLoRA / QLoRA ç­‰ä½Žç§©æ–¹æ³•åªéœ€æ›´æ–°ä¸€å°éƒ¨åˆ†å‚æ•°ã€‚ |



## ä¸åŒè§„æ¨¡æ¨¡åž‹çš„æ˜¾å­˜éœ€æ±‚å‚è€ƒ

æ˜¯ä¸šç•Œå¸¸è§ LLMï¼ˆä»¥ **Transformer decoder-only æž¶æž„** ä¸ºä¾‹ï¼‰åœ¨ä¸åŒå¾®è°ƒæ–¹å¼ä¸‹çš„æ˜¾å­˜å‚è€ƒðŸ‘‡

| æ¨¡åž‹           | å‚æ•°é‡ | **å…¨å‚æ•°å¾®è°ƒï¼ˆFP16ï¼‰** | **LoRA å¾®è°ƒï¼ˆFP16ï¼‰** | **QLoRA å¾®è°ƒï¼ˆ4bitï¼‰** |
| -------------- | ------ | ---------------------- | --------------------- | ---------------------- |
| **LLaMA 7B**   | ~7B    | â‰ˆ 80GB+                | â‰ˆ 16GB                | âœ… â‰ˆ 8GB                |
| **LLaMA 13B**  | ~13B   | â‰ˆ 160GB+               | â‰ˆ 24GB                | âœ… â‰ˆ 10â€“12GB            |
| **LLaMA 30B**  | ~30B   | â‰ˆ 350GB+               | â‰ˆ 40â€“48GB             | âœ… â‰ˆ 20â€“24GB            |
| **LLaMA 70B**  | ~70B   | â‰ˆ 800GB+               | â‰ˆ 80â€“100GB            | âœ… â‰ˆ 40GBï¼ˆå¤šå¡ï¼‰       |
| **Mistral 7B** | 7B     | â‰ˆ 70GB                 | â‰ˆ 16GB                | âœ… â‰ˆ 8GB                |
| **GPT-J 6B**   | 6B     | â‰ˆ 60GB                 | â‰ˆ 14GB                | âœ… â‰ˆ 8GB                |



## ä¸åŒå¾®è°ƒæ–¹å¼çš„æ˜¾å­˜å¯¹æ¯”



| å¾®è°ƒæ–¹å¼                           | æ˜¯å¦æ›´æ–°å…¨éƒ¨å‚æ•°                | æ˜¾å­˜å ç”¨ | æ•ˆæžœ      | ç‰¹ç‚¹                      |
| ---------------------------------- | ------------------------------- | -------- | --------- | ------------------------- |
| **å…¨å‚æ•°å¾®è°ƒ (Full Fine-tuning)**  | âœ… å…¨éƒ¨å‚æ•°                      | ðŸ”¥ æžé«˜   | â­ æœ€å¼º    | éœ€å¤š GPUï¼ˆA100/L40Sé›†ç¾¤ï¼‰ |
| **LoRA / PEFT å¾®è°ƒ**               | âŒ åªæ›´æ–°ä½Žç§©çŸ©é˜µ                | ðŸ‘ ä¸­ç­‰   | âœ… 90%æ€§èƒ½ | ä¸»æµæ–¹æ¡ˆï¼Œé€‚åˆå•æœºå¤šå¡    |
| **QLoRA å¾®è°ƒ**                     | âŒ åœ¨ 4-bit æƒé‡é‡åŒ–ä¸ŠåŠ  LoRA å±‚ | ðŸ’ª æžä½Ž   | âœ… 95%æ€§èƒ½ | å¯åœ¨å•å¼  3090/4090 ä¸Šè·‘   |
| **Prefix / Adapter / P-Tuning v2** | âŒ æ’å…¥å°æ¨¡å—                    | ðŸ’ª ä½Ž     | âšª ä¸­ç­‰    | ç”¨äºŽè½»ä»»åŠ¡åœºæ™¯            |





## å®žæ“æŽ¨èï¼ˆå®žç”¨è§†è§’ï¼‰



| ç›®æ ‡           | å»ºè®®æ–¹æ¡ˆ                                        | æ˜¾å¡é…ç½®                   |
| -------------- | ----------------------------------------------- | -------------------------- |
| å­¦ä¹ /æ•™å­¦å®žéªŒ  | **QLoRA + 7B æ¨¡åž‹**                             | å•å¼  RTX 4090 / A6000 / L4 |
| ä¸­å°åž‹äº§å“å¾®è°ƒ | **LoRA + 13B æ¨¡åž‹**                             | 2Ã—A100 40GB / L40S         |
| ä¼ä¸šçº§é«˜æ€§èƒ½   | **Full Finetune + 70B æ¨¡åž‹**                    | 8Ã—A100 80GB æˆ– L40S é›†ç¾¤   |
| é•¿ä¸Šä¸‹æ–‡ä»»åŠ¡   | **QLoRA + LongContext æ¨¡åž‹ï¼ˆå¦‚ Mistral-Longï¼‰** | 24GBâ€“48GB æ˜¾å­˜å³å¯         |





## æ˜¾å­˜ä¼°ç®—ç»éªŒå…¬å¼

è¿‘ä¼¼ä¼°ç®—æ˜¾å­˜å ç”¨çš„ç»éªŒå…¬å¼ï¼ˆFP16ï¼‰ï¼š    æ˜¾å­˜(GB)â‰ˆå‚æ•°é‡(åäº¿)Ã—2Ã—2+é¢å¤–è®­ç»ƒç¼“å­˜

è§£é‡Šï¼š

- `Ã—2` æ˜¯å› ä¸º FP16 å ç”¨ 2 å­—èŠ‚ï¼›
- å¦ä¸€ä¸ª `Ã—2` æ˜¯æ¢¯åº¦ä¸Žä¼˜åŒ–å™¨çŠ¶æ€ï¼›
- å†åŠ ä¸Š bufferã€activation checkpointã€BatchSizeã€‚

ä¾‹å¦‚ï¼š

- 7B æ¨¡åž‹ â†’ 7Ã—2Ã—2=28GB + buffer â‰ˆ 40â€“80GBï¼›
- 70B æ¨¡åž‹ â†’ 70Ã—2Ã—2=280GB + buffer â‰ˆ 700GBã€‚



## ä¸€å¥è¯æ€»ç»“

> ðŸ’¡ LLMå¾®è°ƒæ˜¯å¦åƒæ˜¾å­˜ï¼Œå…³é”®çœ‹ä½ â€œåŠ¨å¤šå°‘å‚æ•°â€ï¼š
>
> - å…¨é‡è°ƒï¼šç™¾GBèµ·æ­¥ï¼›
> - LoRA è°ƒï¼š20GBå·¦å³ï¼›
> - QLoRA è°ƒï¼š8GB å°±èƒ½è·‘ã€‚