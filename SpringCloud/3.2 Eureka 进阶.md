**Eureka进阶**


 **1.设置Eureka发现服务清除非激活状态服务器的的间隔时间**

microcloud-eureka-7001中的application.yml文件：

添加：

	  server:
	    eviction-interval-timer-in-ms: 600000  #设置清理的间隔时间，而后这个时间使用的毫秒单位。
	    enable-self-preservation: false  #关闭保护模式


保护模式： 只有关闭了以后，才能做失效服务的清理。

此时完整的application.yml：

	server:
	  port: 7001
	eureka: 
	  instance: # eureak实例定义
	    hostname: eureka-7001.com  # 定义Eureka实例所在的主机名称
	  client:
	    fetch-registry: false  # 不注册Eureka自己
	    register-with-eureka: false
	  server:
	    eviction-interval-timer-in-ms: 600000  #设置清理的间隔时间，而后这个时间使用的毫秒单位。
	    enable-self-preservation: false  #关闭保护模式



**在生产环境中，以上两个配置项最好不设置。**

---

**2.为Eureka加上安全认证：**

在pom文件中加上：

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-security</artifactId>
		</dependency>


在application中加上：

	security:
	  basic:
	    enabled: true                    #激活security
	  user:
	    name: edmin                       # 账号
	    password: mldnjava                # 密码



因为加了账号密码，此时eureka和其他module就无法通信。需要修改application.yml的相关配置，增加账号密码。格式为：账号:密码@URL

mircocloud-provider-dept-8001项目中：

由原来的

	eureka:
	  client: # 客户端进行Eureka注册的配置
	    service-url:
	      defaultZone: http://eureka-7001.com:7001/eureka


修改为：

	eureka:
	  client: # 客户端进行Eureka注册的配置
	    service-url:
	      defaultZone: http://edmin:mldnjava@eureka-7001.com:7001/eureka
	  instance:
	    instance-id: dept-8001.com                     #在信息列表显示主机名称
	    prefer-ip-address: true      


