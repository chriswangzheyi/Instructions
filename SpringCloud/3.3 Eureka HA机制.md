**Eureka HA机制**


处理机制： Eureka的互相注册

 **1.修改hosts文件模拟真实环境**

C:\Windows\System32\drivers\etc

	127.0.0.1 eureka-7002.com
	127.0.0.1 eureka-7003.com


 **2.新建两个module**

microcloud-eureka-7002   
microcloud-eureka-7003


按照microcloud-eureka-7001 复制相关类到以上两个module


![](../Images/12.png)




---
microcloud-eureka-7001 的application.yml：

	server:
	  port: 7001
	
	eureka:
	  instance: # eureak实例定义
	    hostname: eureka-7001.com  # 定义Eureka实例所在的主机名称
	  client:
	    service-url:
	      defaultZone: http://edmin:mldnjava@eureka-7002.com:7002/eureka,http://edmin:mldnjava@eureka-7003.com:7003/eureka
	    fetch-registry: false  # 不注册Eureka自己
	    register-with-eureka: false
	
	security:
	  basic:
	    enabled: true                    #激活security
	  user:
	    name: edmin                       # 账号
	    password: mldnjava               # 密码
	
	spring:
	  application:
	    name: microcloud-eureka-7001
	

microcloud-eureka-7002 的application.yml：


	server:
	  port: 7002
	
	eureka: 
	  instance: # eureak实例定义
	    hostname: eureka-7002.com  # 定义Eureka实例所在的主机名称
	  client:
	    service-url:
	      defaultZone: http://edmin:mldnjava@eureka-7001.com:7001/eureka,http://edmin:mldnjava@eureka-7003.com:7003/eureka
	    fetch-registry: false  # 不注册Eureka自己
	    register-with-eureka: false
	
	security:
	  basic:
	    enabled: true                    #激活security
	  user:
	    name: edmin                       # 账号
	    password: mldnjava               # 密码
	
	spring:
	  application:
	    name: microcloud-eureka-7002


microcloud-eureka-7003 的application.yml：

	server:
	  port: 7003
	
	eureka: 
	  instance: # eureak实例定义
	    hostname: eureka-7003.com  # 定义Eureka实例所在的主机名称
	  client:
	    service-url:
	      defaultZone: http://edmin:mldnjava@eureka-7001.com:7001/eureka,http://edmin:mldnjava@eureka-7002.com:7003/eureka
	    fetch-registry: false  # 不注册Eureka自己
	    register-with-eureka: false
	
	security:
	  basic:
	    enabled: true                    #激活security
	  user:
	    name: edmin                       # 账号
	    password: mldnjava               # 密码
	
	spring:
	  application:
	    name: microcloud-eureka-7003


**3.验证**

启动项目，

分别登陆三个Eureka的控制台：

**microcloud-eureka-7001：** http://edmin:mldnjava@eureka-7001.com:7001

**microcloud-eureka-7002：** http://edmin:mldnjava@eureka-7002.com:7002

**microcloud-eureka-7003：** http://edmin:mldnjava@eureka-7003.com:7003   




以microcloud-eureka-7001为例，在DS duplicate可以看到：

![](../Images/13.png)


----

**4.将其他项目也注册在Eureka之中（多台主机注册）：**

以mircocloud-provider-dept-8001为例：


	defaultZone: http://edmin:mldnjava@eureka-7001.com:7001/eureka,http://edmin:mldnjava@eureka-7002.com:7002/eureka,http://edmin:mldnjava@eureka-7003.com:7003/eureka


此时完整的application.yml为：

	server:
	  port: 8001
	
	mybatis:
	  config-location: classpath:mybatis/mybatis.cfg.xml    # mybatis配置文件所在路径
	  type-aliases-package: com.wzy.vo            # 定义所有操作类的别名所在包
	  mapper-locations:                                     # 所有的mapper映射文件
	  - classpath:mybatis/mapper/**/*.xml

	spring:
	  datasource:
	    type: com.alibaba.druid.pool.DruidDataSource    # 配置当前要使用的数据源的操作类型
	    driver-class-name: org.gjt.mm.mysql.Driver      # 配置MySQL的驱动程序类
	    url: jdbc:mysql://localhost:3306/mldn8001           # 数据库连接地址
	    username: root                                  # 数据库用户名
	    password: root                            # 数据库连接密码
	    dbcp2:                                          # 进行数据库连接池的配置
	      min-idle: 5                                   # 数据库连接池的最小维持连接数    
	      initial-size: 5                               # 初始化提供的连接数
	      max-total: 5                                  # 最大的连接数
	      max-wait-millis: 200                         # 等待连接获取的最大超时时间
	  application:
	    name:  microcloud-provider-dept
	
	eureka:
	  client: # 客户端进行Eureka注册的配置
	    service-url:
	      defaultZone: http://edmin:mldnjava@eureka-7001.com:7001/eureka,http://edmin:mldnjava@eureka-7002.com:7002/eureka,http://edmin:mldnjava@eureka-7003.com:7003/eureka
	  instance:
	    instance-id: dept-8001.com                     #在信息列表显示主机名称
	    prefer-ip-address: true                      # 访问路径变为ip地址
	
	info:
	  app.name: mldn-microcloud
	  company.name: www.mldn.cn
	  build.artifactId: $project.artifactId$
	  build.version: $project.verson$
