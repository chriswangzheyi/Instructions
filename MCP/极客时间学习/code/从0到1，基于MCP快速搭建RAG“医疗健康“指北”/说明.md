# MCP RAG 服务搭建指南

## 项目概述

在这个简明清晰的示例中，我们完成了快速搭建 MCP RAG 服务的实践。通过将文档索引与检索功能封装为 MCP 工具，实现了智能化的文档问答系统。

## 核心架构

### 服务端 (RAG Server)

我们利用 **FastMCP** 快速搭建了一个 RAG 服务端，采用以下技术栈：

- **Faiss** - 向量索引引擎
- **OpenAI** - 文本嵌入生成
- **FastMCP** - MCP 服务器框架

#### 核心工具函数

1. **`index_docs(docs)`**
   - **功能**：索引文档集合
   - **作用**：存储文本的向量嵌入
   - **参数**：`docs` - 文档列表

2. **`retrieve_docs(query, top_k)`**
   - **功能**：根据用户查询检索最相关的文档片段
   - **参数**：
     - `query` - 用户查询
     - `top_k` - 返回文档数量（默认3）

### 客户端 (RAG Client)

客户端 `RagClient` 负责与 MCP 服务端通信，关键功能包括：

#### 1. 连接管理
- 使用 `stdio_client` 建立连接
- 通过 `ClientSession` 与服务器交互

#### 2. 工具发现
- 动态获取服务器端提供的工具列表
- 将工具信息传递给 LLM API

#### 3. 工具调用
- 实现动态工具调用机制
- 自动根据 LLM 的工具调用请求执行相应的 MCP 工具

## MCP 通信机制

整个过程中 MCP 的通信机制明确分为三个阶段：

### 1. 初始化阶段
- 客户端请求服务器的功能支持与协议版本
- 建立连接并验证兼容性

### 2. 通信阶段
- 客户端与服务器交换请求和通知
- 调用并执行工具
- 处理工具调用结果

### 3. 终止阶段
- 安全结束通信
- 释放资源

## 设计精髓

此设计的精髓在于将**文档索引（Embedding）**与**检索（Retrieval）**功能封装为 MCP 工具，服务于客户端请求。通过标准化的 MCP 协议，实现了：

- **模块化设计** - 服务端和客户端分离
- **工具化封装** - 将复杂功能抽象为简单工具
- **标准化通信** - 使用 MCP 协议进行交互
- **动态扩展** - 支持工具的动态发现和调用

## 使用场景

本系统特别适用于：

- **医疗健康问答** - 基于医学文档的智能问答
- **知识库检索** - 企业文档的智能检索
- **专业领域咨询** - 基于专业文档的咨询服务

## 技术优势

- **快速搭建** - 使用 FastMCP 快速构建
- **高效检索** - Faiss 提供高性能向量检索
- **智能问答** - 结合 LLM 的智能理解能力
- **标准化** - 遵循 MCP 协议标准
