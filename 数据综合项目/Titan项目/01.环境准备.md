# 01.环境准备

## 准备三台服务器

* titan1: 192.168.3.111
* titan2: 192.168.3.112
* titan3: 192.168.3.113

## 设置java home

查询java 安装地址

	[root@titan1 zheyi]# ls -lrt /etc/alternatives/java
	lrwxrwxrwx. 1 root root 71 Jul 20 19:29 /etc/alternatives/java -> /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64/jre/bin/java

设置环境变量

	vi /etc/profile

插入：

	export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-1.el7.x86_64/jre/bin/java
	export PATH=$JAVA_HOME/bin:$PATH
	export JAVA_HOME PATH
	CLASSPATH=.:$JAVA_HOME/jre/lib/ext:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar

生效：

	source /etc/profile

## 准备好mysql

### 安装步骤
登录192.168.3.111

#### 安装步骤

详见mysql 《mysql单节点安装》

### 初始化数据

	create database realtimedw; 
	
#### 执行脚本

用navicat连接mysql数据库，导入下面两个sql ( 项目所需资源-日志数据模拟器-初始化数据)

	realtimedw.sql
	t_md_areas.sql

#### 其他数据准备

	mkdir /root/loginit

放入：

	area.txt
	eventIds.txt
	phoneinfo.txt
	releasechannel.txt
	
#### 对jar包内容进行修改 （log_gen_app.jar，log_gen_wx.jar）

主要是为了修改mysql的账号密码

other.properties

	# logger,kafka
	sink.type=logger
	
	#roll  console dayroll
	logger.type=dayroll
	
	initdata.releasechannel=/opt/data/loginit/releasechannel.txt
	initdata.phoneinfo=/opt/data/loginit/phoneinfo.txt
	initdata.eventIds=/opt/data/loginit/eventIds.txt
	init.user.area=/opt/data/loginit/area.txt
	
	db.url=jdbc:mysql://127.0.0.1:3306/realtimedw?useUnicode=true&characterEncoding=utf8&useSSL=false
	db.user=root
	db.password=1qa2ws#ED
	
	# max concurrent accessor amount
	online.max.num=100
	  

#### 解压jar

#### 打包jar

	cd log_gen_app/
	jar cvf log_gen_app.jar *

#### 创建对应的文件夹

	mkdir -p /opt/data/loginit/	 
	  
#### 启动模拟器

上传jar包

	log_gen_app.jar	log_gen_wx.jar
	
上传文件

	/opt/data/loginit/releasechannel.txt
	/opt/data/loginit/phoneinfo.txt
	/opt/data/loginit/eventIds.txt
	/opt/data/loginit/area.txt		
	
开两个terminal执行：(关闭的时候就停止生成日志)
	
  	# 启动微信小程序端日志模拟器 
	java -cp log_gen_wx.jar cn.doitedu.loggen.entry.GenWxAppLog 
	# 启动app端日志模拟器
	java -cp log_gen_app.jar cn.doitedu.loggen.entry.GenAppLog
	

查看是否生成日志：

	[zheyi@titan1 logdata]$ pwd
	/opt/data/logdata
	yum -y install tree
	
	[root@titan1 logdata]# tree
	.
	├── app
	│   └── event_log_
	└── wx
	    └── event_log_


日志demo：

	{"account":"","appId":"cn.doitedu.app1","appVersion":"2.0","carrier":"腾讯移动","deviceId":"eF9sq47kz2ZQ","deviceType":"HUAWEI-RY-10","eventId":"adShow","ip":"84.91.165.76","latitude":22.81346276484242,"longitude":107.13710947576692,"netType":"4G","osName":"android","osVersion":"7.8","properties":{"adCampain":"5","adId":"5","adLocation":"10","pageId":"523"},"releaseChannel":"车载安卓市场","resolution":"1024*768","sessionId":"hpkX3j8CTOz","timeStamp":1659537668604}
	{"account":"","appId":"cn.doitedu.app1","appVersion":"3.4","carrier":"中国移动","deviceId":"yvllWDW7Vlf1","deviceType":"IPHONE-X","eventId":"thumbup","ip":"72.127.231.96","latitude":44.13507002931519,"longitude":125.48246029448715,"netType":"3G","osName":"ios","osVersion":"10.0","properties":{"pageId":"333","productId":"572","title":"GXL FSG ORK","url":"IGl/zhK"},"releaseChannel":"爱吾游戏宝盒","resolution":"2048*1024","sessionId":"2BDxMMuvddG","timeStamp":1659537668628}