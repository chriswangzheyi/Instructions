# 12.3 电影点评系统-TopN

## 前提条件

基于12.1 和12.2的内容

## 代码

	   //TopN
	    val genderRatings = ratings.map( x => (x._1,(x._1,x._2,x._3)) ) //(UserID,(UserID,MovieID,Rating))
	      .join(
	        usersRDD.map(_.split("::")).map( x => (x(0),x(1))).cache() // (UserID,Gender)
	      )
	    genderRatings.take(2).foreach(println)  // (UserID,((UserID,MovieID,Rating),Gender))
	
	    val maleFilteredRatings  = genderRatings.filter(x =>x._2._2.equals("M")).map(x => x._2._1)  //(UserID,MovieID,Rating)
	    val femaleFilteredRatings = genderRatings.filter(x =>x._2._2.equals("F")).map(x => x._2._1)  //(UserID,MovieID,Rating)
	
	    println("所有电影中最受男性喜欢的电影Top10：")
	    maleFilteredRatings.map(x => (x._2,(x._3.toDouble,1))) // (MovieID, (Rating,1))
	      .reduceByKey((x,y) => (x._1+y._1,x._2+y._2))   // MovieID,(总Rating数,总评分人数)
	      .map(x => (x._2._1.toDouble / x._2._2,x._1 ))
	      .sortByKey(false)
	      .map(x => (x._2,x._1))
	      .take(10)
	      .foreach(println)
	
	    println("所有电影中最受女性喜欢的电影Top10：")
	    femaleFilteredRatings.map(x => (x._2,(x._3.toDouble,1)))
	      .reduceByKey((x,y) => (x._1+y._1,x._2+y._2))
	      .map(x => (x._2._1.toDouble / x._2._2,x._1 ))
	      .sortByKey(false)
	      .map(x => (x._2,x._1))
	      .take(10)
	      .foreach(println)
