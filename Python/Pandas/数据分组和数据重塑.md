# 数据分组和数据重塑



## 数据分组

![](../Images/1.png)

### Demo

	import pandas as pd
	
	# 导入数据
	data = pd.read_csv('E://olympics.csv',skiprows=4)
	
	# 常用操作
	group = data.groupby('Edition')
	size = data.groupby('Edition').size()
	multigroup = data.groupby(['Edition','NOC','Medal'])
	dict  = data.groupby(['Edition','NOC','Medal']).agg({'Edition':['min','max','count']})
	
	# print(size)
	# print(multigroup.size())
	# print(dict)
	# # 迭代打印
	# for key, value in group:
	#     print(key)
	#     print(value)
	
	
	
	luis= data[data.Athlete =='LEWIS, Carl'].groupby('Athlete').agg({'Edition':['min','max','count']})
	print(luis)



### Demo2

Create a list showing the total number of medals won for each country over the history of the Olympics. For each country, include the year of the first and most recent Olympic medal wins.

	import pandas as pd
	
	# 导入数据
	data = pd.read_csv('E://olympics.csv',skiprows=4)
	
	year = data.groupby(['NOC']).agg( {'Edition':['min','max','count'] } )
	print(year)


## 数据重塑


![](../Images/2.png)


### 定义

stack：将数据的列“旋转”为行

unstack：将数据的行“旋转”为列


### Demo

	import pandas as pd
	import numpy as np
	
	data = pd.DataFrame(np.arange(6).reshape((2,3)),index=pd.Index(['Ohio','Colorado'],name='state')
	                   ,columns=pd.Index(['one','two','three'],name='number'))
	
	print('------原始数据：----------')
	print(data)
	
	
	after_stack = data.stack()  #stack操作后将列索引number旋转为行索引，并且置于行索引的最内层（外层为索引state），也就是将旋转轴（number）的结果置于 最低级别。
	print("-------stck处理后：--------")
	print(after_stack)
	
	
	after_unstack=after_stack.unstack()
	print("--------unstck处理后：--------")
	print(after_unstack)

输出：

	------原始数据：----------
	number    one  two  three
	state                    
	Ohio        0    1      2
	Colorado    3    4      5
	-------stck处理后：--------
	state     number
	Ohio      one       0
	          two       1
	          three     2
	Colorado  one       3
	          two       4
	          three     5
	dtype: int32
	--------unstck处理后：--------
	number    one  two  three
	state                    
	Ohio        0    1      2
	Colorado    3    4      5


### Demo2

Q1: Plot the number of gold medals won by the USA male and female atheletes throughout the history of the Olympics?


Q2: Plot the 5 athletes who have won the most gold medals over the history of the Olympics. When there is a tie, consider the number of silver medals, then bronze medals.


解答：

	import pandas as pd
	import matplotlib.pyplot as plt
	
	data = pd.read_csv('E://olympics.csv',skiprows=4)
	
	q1 = data[ (data.NOC=='USA') & (data.Medal=='Gold') ].groupby(['Gender','Edition']).size().unstack('Gender',fill_value=0)
	# print(q1)
	# q1.plot()
	# plt.show()
	
	q2 = data.groupby(['Athlete','Medal']).size().unstack('Medal',fill_value=0).sort_values( ['Gold','Silver','Bronze'], ascending=False)[['Gold','Silver','Bronze']].head(5)
	print(q2)


