**使用DockerMaven插件自动打包**



**1. 修改Docker配置**


    vim /lib/systemd/system/docker.service

在ExecStart=后添加配置： 

    -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375


![](../Images/5.png)



重启Docker


    systemctl daemon-reload

然后

     service docker restart


验证：

     netstat -an | grep 2375


**2. 在项目中加入DockerMaven插件**


在Pom中增加：

	<build>
        <finalName>app</finalName>
        <plugins>
            <!-- docker的maven插件，官网：https://github.com/spotify/docker-maven-plugin -->
            <plugin>
                <groupId>com.spotify</groupId>
                <artifactId>docker-maven-plugin</artifactId>
                <version>0.4.13</version>
                <configuration>
                    <!-- 注意imageName一定要是符合正则[a-z0-9-_.]的，否则构建不会成功 -->
                    <!-- 详见：https://github.com/spotify/docker-maven-plugin    Invalid repository name ... only [a-z0-9-_.] are allowed-->
                    <imageName>eureka</imageName>
                    <baseImage>docker.io/kdvolder/jdk8</baseImage>
                    <entryPoint>["java", "-jar", "/${project.build.finalName}.jar"]</entryPoint>
                    <resources>
                        <resource>
                            <targetPath>/</targetPath>
                            <directory>${project.build.directory}</directory>
                            <include>${project.build.finalName}.jar</include>
                        </resource>
                    </resources>
                    <dockerHost>http://47.112.142.231:2375</dockerHost>
                </configuration>
            </plugin>
        </plugins>
    </build>



需要在项目中的Pom文件中修改imageName、baseImage 、entryPoint等参数。 dockerHost需要修改为宿主机ip。

---

**3.构建镜像**


IDEA alt+ f12 唤出命令行


在三个项目的目录中执行：

    mvn clean package docker:build



验证docker image看看是否构建成功：

**docker images**


**4.启动服务**


    docker run -di --name=eureka -p 7000:7000 zheyi_eureka
    
    docker run -di --name=zuul -p 8888:8888 zheyi_zuul
    
    docker run -di --name=article -p 9001:9001 zheyi_article



**5.验证是否成功**

    http://47.112.142.231:7000/
    
    http://47.112.142.231:9001/article
    
    http://47.112.142.231:8888/app/article

