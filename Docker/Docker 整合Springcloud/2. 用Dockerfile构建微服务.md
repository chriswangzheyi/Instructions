**用Dockerfile构建微服务**


手动部署微服务


**1.修改配置文件**


将所有的application.yml及pom.xml中的localhost换成docker 部署服务器宿主机的url。

---

**2.在docker服务器安装mysql并插入测试数据**

创建MySQL容器

    docker run -di --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root mysql


进入容器

    docker exec -it mysql /bin/bash

进入mysql

    mysql -u root -p

进行授权远程连接(注意mysql 8.0跟之前的授权方式不同)

    GRANT ALL ON *.* TO 'root'@'%';

刷新权限
    
    flush privileges;


更改加密规则

    ALTER USER 'root'@'localhost' IDENTIFIED BY 'password' PASSWORD EXPIRE NEVER;


更新root用户密码

    ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'root';

刷新权限

    flush privileges;


此时可以远程访问Mysql

---

创建docker_test数据库，新建tb_table表

![](../Images/2.png)


插入测试数据

---

**3.构建Eureka镜像**


用Maven 打包， 得到app.jar

编写Dockerfile：

	FROM docker.io/kdvolder/jdk8
	VOLUME /tmp
	ADD app.jar /app.jar
	EXPOSE 7000
	ENTRYPOINT ["java","-jar","/app.jar"]



FROM docker.io/kdvolder/jdk8 这一句的意思是该项目是基于jdk8环境的

将app.jar 和 Dockerfile放在同一个目录下


执行

    docker build -t zheyi_article .



启动容器：

    docker run -di --name=article -p 9001:9001 zheyi_article


验证：

访问{ip:port}:7000

如：

    http://47.112.142.231:7000/

---


**4.构建Article镜像**

用Maven 打包， 得到app.jar

编写Dockerfile：

	FROM docker.io/kdvolder/jdk8
	VOLUME /tmp
	ADD app.jar /app.jar
	EXPOSE 7000
	ENTRYPOINT ["java","-jar","/app.jar"]




将app.jar 和 Dockerfile放在同一个目录下


执行

    docker build -t zheyi_eureka .



启动容器：

    docker run -di --name=eureka -p 7000:7000 zheyi_eureka

验证：

访问{ip:port}:9001/article

如：

    http://47.112.142.231:9001/article



**5.构建Zuul镜像**

用Maven 打包， 得到app.jar

编写Dockerfile：

	FROM docker.io/kdvolder/jdk8
	VOLUME /tmp
	ADD app.jar /app.jar
	EXPOSE 8888
	ENTRYPOINT ["java","-jar","/app.jar"]




将app.jar 和 Dockerfile放在同一个目录下


执行

    docker build -t zheyi_zuul .



启动容器：

    docker run -di --name=zuul -p 8888:8888 zheyi_zuul

验证：

访问{ip:port}:8888/app/article

如：

    http://47.112.142.231:8888/app/article