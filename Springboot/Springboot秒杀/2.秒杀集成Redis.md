# 2. 秒杀集成Redis

---

## 创建Redis镜像

 	docker run -d -p 6379:6379 --name myredis redis

## 修改项目文件

### pom:

新增：

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-cache</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-redis</artifactId>
		</dependency>

		<dependency>
			<groupId>commons-codec</groupId>
			<artifactId>commons-codec</artifactId>
            <version>1.11</version>
		</dependency>



### SpringbootSeckillApplication：

增加注解：

	@EnableCaching


### GoodsService:

给方法增加上Cacheable注解：


	package com.wzy.springboot_seckill.service;
	
	import com.wzy.springboot_seckill.dao.GoodsCoverDAO;
	import com.wzy.springboot_seckill.dao.GoodsDAO;
	import com.wzy.springboot_seckill.dao.GoodsDetailDAO;
	import com.wzy.springboot_seckill.dao.GoodsParamDAO;
	import com.wzy.springboot_seckill.entity.Goods;
	import com.wzy.springboot_seckill.entity.GoodsCover;
	import com.wzy.springboot_seckill.entity.GoodsDetail;
	import com.wzy.springboot_seckill.entity.GoodsParam;
	import org.springframework.cache.annotation.Cacheable;
	import org.springframework.stereotype.Service;
	
	import javax.annotation.Resource;
	import java.util.List;
	
	@Service
	public class GoodsService {
	
	    @Resource
	    private GoodsDAO goodsDAO;
	    @Resource
	    private GoodsCoverDAO goodsCoverDAO;
	    @Resource
	    private GoodsDetailDAO goodsDetailDAO;
	    @Resource
	    private GoodsParamDAO goodsParamDAO;
	
	    //view -> controller -> service -> dao
	    @Cacheable(value="goods" , key = "#goodsId") //key:  goods::1  goods::2
	    public Goods getGoods(Long goodsId) {
	        return goodsDAO.findById(goodsId);
	    }
	
	    @Cacheable(value="covers" , key = "#goodsId")
	    public List<GoodsCover> findCovers(Long goodsId){
	        return goodsCoverDAO.findByGoodsId(goodsId);
	    }
	
	    @Cacheable(value="details" , key = "#goodsId")
	    public List<GoodsDetail> findDetails(Long goodsId){
	        return  goodsDetailDAO.findByGoodsId(goodsId);
	    }
	
	    @Cacheable(value="params" , key = "#goodsId")
	    public List<GoodsParam> findParams(Long goodsId){
	        List list =  goodsParamDAO.findByGoodsId(goodsId);
	        return list;
	    }
	
	}


### Entity

因为redis需要Entity都序列号，所以需要在所有的eneity上implements Serializable


## Redis destop manager

下载Redis destop manager

![](../Images/10.png)


## 验证

请求

	http://localhost:8080/goods/?gid=739


第一次请求慢，第二次请求快


在redis desktop manager中也生成了对应的key：

![](../Images/11.png)
