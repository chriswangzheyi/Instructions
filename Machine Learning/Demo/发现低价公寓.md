# 发现低价公寓


	import pandas as pd
	import re
	import numpy as np
	import matplotlib.pyplot as plt
	
	plt.style.use('ggplot')
	
	pd.set_option("display.max_columns",30)
	pd.set_option("display.max_colwidth",100)
	pd.set_option("display.precision",3)
	pd.set_option('display.width', 1000)
	
	CSV_PATH=r"E:\projects\magic.csv"
	
	df = pd.read_csv(CSV_PATH)
	
	# multiple units, 关键字 Apartments 复数形式
	mu = df[ df['listingtype_value'].str.contains('Apartments For')]
	
	# single units, 关键字 Apartment 单数形式
	su = df[ df['listingtype_value'].str.contains('Apartment For')]
	
	# 选择拥有浴室的房源
	no_baths = su[~(su['propertyinfo_value'].str.contains('ba'))]
	
	# 排除确实了浴室信息的房源
	sucln = su[~su.index.isin(no_baths.index)]
	
	
	def parse_info(row):
	    if not 'sqft' in row:
	        br,ba = row.split('•')[:2]
	        sqft = np.nan
	    else:
	        br,ba,sqft = row.split('•')[:3]
	    return pd.Series({'Beds':br,'Baths':ba,'Sqft':sqft})
	
	attr =sucln['propertyinfo_value'].apply(parse_info)
	
	# 将字符串删除
	attr_cln = attr.applymap(lambda x: x.strip().split(' ')[0] if isinstance (x,str) else np.nan )
	
	#print(attr_cln)
	
	
	sujnd = sucln.join(attr_cln)
	
	#print(sujnd.T)
	
	def parse_addy(r):
	    so_zip = re.search(',NY(\d+)',r)
	    so_flr = re.search('(?:APT|#)\s+(\d+)[A-Z]+,',r)
	    if so_zip:
	        zipc = so_zip.group(1)
	    else:
	        zipc = np.nan
	
	    if so_flr:
	        flr = so_flr.group(1)
	    else:
	        flr=  np.nan
	    return pd.Series({'Zip':zipc, 'Floor':flr})
	
	flrzip=sujnd['routable_link/_text'].apply(parse_addy)
	
	suf = sujnd.join(flrzip)
	
	print(suf.T)