# 13.Triger

## 背景

在Flink中，有两种窗口类型，一种是基于时间的窗口timeWindow，一种是基于计数的窗口countWindow。可是是否存在一种状况，若是使用timeWindow，在窗口时间内，出现大量的数据过来，对该窗口的计算产生很大的压力，那该怎么办呢？是否可以结合两种窗口进行触发呢？答案是能够的，trigger正能够达到你的要求。

## 作用：

 经过自定义一些规则，例如窗口元素上限、时间上限等等，来触发窗口计算。
 
## 触发方法

* onElement()  ：    进入窗口的每一个元素都会调用该方法。
* onEventTime() ： 事件时间timer触发的时候被调用。
* onProcessingTime() ： 处理时间timer触发的时候会被调用。
* onMerge()  ： 有状态的触发器相关，并在它们相应的窗口合并时合并两个触发器的状态，例如使用会话窗口。
* clear()  ： 该方法主要是执行窗口的删除操做


## Demo

### CountTrigger

根据数量触发Trigger

#### 代码

	package wzy
	
	import org.apache.flink.streaming.api.scala._
	import org.apache.flink.streaming.api.windowing.assigners.GlobalWindows
	import org.apache.flink.streaming.api.windowing.triggers.CountTrigger
	
	object TrigerDemo {
	
	  def main(args: Array[String]): Unit = {
	
	    val env = StreamExecutionEnvironment.getExecutionEnvironment
	
	    val text = env.socketTextStream("47.112.142.231", 9999)
	
	    val counts = text
	      .map {(_,1)}
	      .keyBy(_._1)
	      .window(GlobalWindows.create())
	      .trigger(CountTrigger.of(2))
	      .sum(1)
	      .print()
	
	    env.execute("triger demo")
	
	  }
	}

#### 验证

输入：

	test
	test
	test
	test

fliink 程序：

	7> (test,2)
	7> (test,4)

每隔2个元素，打印一次

 
 