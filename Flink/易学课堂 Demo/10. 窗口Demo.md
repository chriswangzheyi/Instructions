#10. 窗口Demo

## countWindowAll

### 定义

全局window，按数据数量进行窗口划分

![](Images/18.png)

### 代码

	package wzy
	
	import org.apache.flink.streaming.api.scala._
	
	//不分组划分窗口
	//按照数据的条数划分，CountWindow属于Global window
	object countwindowdemo {
	1
	  def main(args: Array[String]): Unit = {
	
	    val env = StreamExecutionEnvironment.getExecutionEnvironment
	    val lines = env.socketTextStream("47.112.142.231",9999)
	
	    //将读数转化为int，然后每3个数做一次窗口，然后求和
	    val window =lines.map(_.toInt).countWindowAll(3).sum(0).print()
	
	    env.execute("countwindowdemo")
	
	  }
	
	}

### 验证

监听服务器

	[root@iZwz930tnxht4q6f3yxum6Z ~]# nc -l 9999
	1
	2
	3
	4
	5
	6

flink侧

	1> 6
	2> 15



##  滚动时间窗口 (Tumbling Time Window)

* 将数据依据固定的窗口长度对数据进行切分
* 时间对齐，窗口长度固定，没有重叠
* 每条数据只会被划分到一个窗口中

![](Images/19.png)


### 代码

	package wzy
	
	import org.apache.flink.streaming.api.scala._
	import org.apache.flink.streaming.api.windowing.assigners.TumblingProcessingTimeWindows
	import org.apache.flink.streaming.api.windowing.time.Time
	
	
	object TumblingTimeWindow {
	
	  def main(args: Array[String]): Unit = {
	
	    val env = StreamExecutionEnvironment.getExecutionEnvironment
	
	    val text = env.socketTextStream("47.112.142.231", 9999)
	
	    val counts = text.flatMap { _.toLowerCase.split("\\W+") filter { _.nonEmpty } }
	      .map { (_, 1) }
	      .keyBy(_._1)
	      .window(TumblingProcessingTimeWindows.of(Time.seconds(5)))
	      .sum(1)
	
	    counts.print()
	
	    env.execute("TumblingTimeWindow")
	
	  }

	}


### 验证

示例为单位时间5秒为一个窗口。

第一个5秒输入：

	[root@iZwz930tnxht4q6f3yxum6Z ~]# nc -l 9999
	1
	1
	1
	2
	1
	2

flink程序：
	
	3> (2,2)
	6> (1,4)
	

第二个5秒输入：

	1
	2
	
flink程序：
	6> (1,1)
	3> (2,1)	